---
# Install Claude CLI - idempotent

- name: Check if Claude CLI is installed
  ansible.builtin.command: which claude
  register: claude_installed
  changed_when: false
  failed_when: false

- name: Install Claude CLI via native installer
  ansible.builtin.shell: |
    curl -fsSL https://claude.ai/install.sh | bash
  when: claude_installed.rc != 0
  args:
    creates: "{{ ansible_env.HOME }}/.claude/local/bin/claude"

- name: Ensure Claude config directory exists
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.claude"
    state: directory
    mode: '0700'

- name: Copy Claude settings
  ansible.builtin.template:
    src: settings.json.j2
    dest: "{{ ansible_env.HOME }}/.claude/settings.json"
    mode: '0600'
